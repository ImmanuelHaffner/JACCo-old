
typedef float V __attribute__((vector_size(8)));

typedef unsigned int VI __attribute__((vector_size(8)));




struct S
{
  V in;
  VI mask;
  V out;
};

struct S tests[] = {
  { { 0.69314718055994530942f, 2.7182818284590452354f }, { 0, 1 }, { 0.69314718055994530942f, 2.7182818284590452354f } },
  { { 0.69314718055994530942f, 2.7182818284590452354f }, { -16, -1 }, { 0.69314718055994530942f, 2.7182818284590452354f } },
  { { 0.69314718055994530942f, 2.7182818284590452354f }, { 1, 0 }, { 2.7182818284590452354f, 0.69314718055994530942f } },
  { { 0.69314718055994530942f, 2.7182818284590452354f }, { 0, 0 }, { 0.69314718055994530942f, 0.69314718055994530942f } },
  { { 3.14159265358979323846f, 1.41421356237309504880f }, { 1, 1 }, { 1.41421356237309504880f, 1.41421356237309504880f } },
  { { 3.14159265358979323846f, 1.41421356237309504880f }, { 1, 0 }, { 1.41421356237309504880f, 3.14159265358979323846f } },
};

struct S2
{
  V in1, in2;
  VI mask;
  V out;
};

struct S2 tests2[] = {
  { { 0.69314718055994530942f, 2.7182818284590452354f }, { 3.14159265358979323846f, 1.41421356237309504880f }, { 0, 1 }, { 0.69314718055994530942f, 2.7182818284590452354f } },
  { { 0.69314718055994530942f, 2.7182818284590452354f }, { 3.14159265358979323846f, 1.41421356237309504880f }, { 2, 3 }, { 3.14159265358979323846f, 1.41421356237309504880f } },
  { { 0.69314718055994530942f, 2.7182818284590452354f }, { 3.14159265358979323846f, 1.41421356237309504880f }, { 0, 2 }, { 0.69314718055994530942f, 3.14159265358979323846f } },
  { { 0.69314718055994530942f, 2.7182818284590452354f }, { 3.14159265358979323846f, 1.41421356237309504880f }, { 2, 1 }, { 3.14159265358979323846f, 2.7182818284590452354f } },
  { { 0.69314718055994530942f, 2.7182818284590452354f }, { 3.14159265358979323846f, 1.41421356237309504880f }, { 3, 0 }, { 1.41421356237309504880f, 0.69314718055994530942f } },
  { { 0.69314718055994530942f, 2.7182818284590452354f }, { 3.14159265358979323846f, 1.41421356237309504880f }, { 0, 0 }, { 0.69314718055994530942f, 0.69314718055994530942f } },
  { { 0.69314718055994530942f, 2.7182818284590452354f }, { 3.14159265358979323846f, 1.41421356237309504880f }, { 3, 3 }, { 1.41421356237309504880f, 1.41421356237309504880f } },
};


extern void abort(void);

int main()
{

  int i;

  for (i = 0; i < sizeof(tests)/sizeof(tests[0]); ++i)
    {
      V r = __builtin_shuffle(tests[i].in, tests[i].mask);
      if (__builtin_memcmp(&r, &tests[i].out, sizeof(V)) != 0)
 abort();
    }

  for (i = 0; i < sizeof(tests2)/sizeof(tests2[0]); ++i)
    {
      V r = __builtin_shuffle(tests2[i].in1, tests2[i].in2, tests2[i].mask);
      if (__builtin_memcmp(&r, &tests2[i].out, sizeof(V)) != 0)
 abort();
    }


  return 0;
}
